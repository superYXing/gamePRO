## 1. 项目说明（README.md）
#### **note**: 可通过夸克网盘下载到本地，无需任何配置直接运行
#### **引言：致敬中国医师节**

值此8月19日中国医师节之际，我们谨以此作，向每一位在理性与感性的天平上艰难行走、于无声处守护生命的中国医者，致以最崇高的敬意。


#### 项目简介
《完美医生》是一款**以前沿大型语言模型（LLM）为核心驱动**的创新性微恐、Roguelite模拟经营游戏。本作基于Ren'Py引擎，深度集成了AI医患对话与实时TTS语音合成技术。玩家将扮演一位被困于无尽工作循环中的医生，通过与AI实时扮演的、拥有深度人格的各类病人进行多轮对话式诊疗，亲身体验医生在高压工作中所面临的、在 **“极致理性效率”** 与 **“宝贵人性共情”** 之间的宿命般的艰难抉择。

### 核心玩法与创新

本作的核心机制是一个我们称之为**“理性陷阱”**的颠覆性设计。游戏表面上会用分数、评级等传统方式，即时奖励所有高效、理性的“最优解”行为，从而诱导玩家追求极致效率。然而，这背后隐藏着一个深刻的代价：这些行为将持续消耗玩家唯一的生存资源——**“心智值（Sanity）”**，将玩家推向精神崩溃的边缘。而那些看似浪费时间、不被系统鼓励的“人性化”选择，才是恢复心智、打破循环的唯一“解药”。

### 🎮 游戏与技术特色

* **AI即核心，次世代模型驱动万千灵魂：** 我们突破性地采用了基于**次世代大型语言模型（在设计理念上对标GPT-5）的先进AI技术，将其从内容填充的辅助角色，提升为游戏玩法的核心引擎**。AI不仅负责动态生成无穷变化的病人陈述，更能根据玩家的实时选择，**即时演算**出符合逻辑与情感的对话选项，实现了真正意义上的**动态叙事与玩法生成**。

* **算法与人性的深度对话：** 本项目不仅是“用AI写代码”的技术展示，更是一次**关于“AI时代下人类价值”的深刻探讨**。游戏通过其核心玩法，将“效率能否衡量一切？”这一宏大命题，转化为玩家每一次点击、每一次选择中的切身体验。

* **实时情感TTS语音合成：** 集成OpenAI兼容TTS API（如yunwu.ai），实现高质量的实时语音朗读。每个角色都有专属语音特色，系统更能**智能识别对话情感**，自动调整TTS的语气和语速，极大增强了沉浸感。

* **沉浸式心理体验营造：** 我们构建了一套与玩家核心数值实时联动的**动态音画系统**。BGM不再是固定的背景，而是由医院白噪音构成的、能反映玩家心跳与压力的“音景”；视觉效果也会随着玩家心智值的降低而出现噪点、畸变等“污染”。

### 完成成果与下一步规划

在当前提交的Demo版本中，我们已成功实现了上述**全部核心玩法**：

* **AI驱动的对话式疗程：** 玩家可以完整地体验到与AI扮演的、具有不同人格的病人进行多轮动态对话的核心流程。

* **“理性陷阱”机制：** 游戏内的“绩效分数”与“心智值（Sanity）”系统已实装并运行良好。

* **动态音画与实时TTS系统：** 游戏的BGM、视觉效果与TTS语音均能根据游戏状态进行实时变化，成功营造了核心的微恐与压抑氛围。

**下一步规划：**
我们当前坚实的核心玩法框架，为下一步的**Roguelite化**开发奠定了完美的基础。我们的未来工作将聚焦于：扩展更丰富的随机病人事件库，并加入局外成长系统（如技能树），最终将《完美医生》打造成一款内容饱满、高度可重玩的完整游戏。

---

## 🛠️ 技术栈

### 游戏引擎
- **Ren'Py** - 现代视觉小说引擎，支持Python脚本和复杂的游戏逻辑

### AI集成
- **OpenAI API** - 驱动AI对话生成和角色扮演
- **GPT-4 系列模型** - 用于智能对话生成和情节推进
- **TTS API** - 实时语音合成，支持多种音色（shimmer, echo, nova, alloy等）

### 网络与通信
- **httpx** - 现代Python HTTP客户端，用于AI API调用
- **异步编程** - 保证游戏流畅性的同时进行AI生成

### 配置与环境管理
- **python-dotenv** - 环境变量管理
- **统一配置系统** - 集中管理API密钥、模型参数等

### 音频系统
- **动态BGM系统** - 根据玩家心智值实时调整音乐
- **实时TTS播放** - 多线程音频处理，支持同步字幕显示
- **音频文件管理** - 自动缓存和清理TTS生成的音频

---

## 📁 项目结构

```
gamePRO/
├── dlutHosGame/                 # 主游戏目录
│   ├── game/                    # Ren'Py游戏核心
│   │   ├── *.rpy               # 游戏脚本文件
│   │   │   ├── script.rpy      # 主脚本入口
│   │   │   ├── day1.rpy        # 第一天剧情脚本
│   │   │   ├── core_systems.rpy # 核心系统定义
│   │   │   └── screens.rpy     # UI界面定义
│   │   ├── *.py                # Python模块
│   │   │   ├── ai_module.py    # AI对话管理模块
│   │   │   ├── tts_module.py   # TTS语音合成模块
│   │   │   └── config.py       # 配置管理模块
│   │   ├── audio/              # 音频资源
│   │   │   ├── bgm/           # 背景音乐
│   │   │   ├── sfx/           # 音效文件
│   │   │   └── tts/           # TTS生成的音频缓存
│   │   ├── images/             # 图像资源
│   │   ├── gui/               # UI图形资源
│   │   ├── python-packages/    # Python第三方库
│   │   │   ├── httpx/         # HTTP客户端库
│   │   │   ├── openai/        # OpenAI SDK
│   │   │   ├── pydantic/      # 数据验证库
│   │   │   └── ...            # 其他依赖库
│   │   └── cache/             # 缓存文件
│   ├── *.py                    # 测试和工具脚本
│   │   ├── test_tts_complete.py     # TTS功能完整测试
│   │   ├── simple_tts_test.py       # TTS简单测试
│   │   ├── debug_tts_system.py     # TTS系统调试
│   │   └── test_httpx_installation.py # httpx安装测试
│   └── run_tts_test.bat        # Windows测试脚本
├── .gitignore                  # Git忽略文件配置
├── README.md                   # 项目文档
└── .env.example               # 环境变量配置示例
```

---

## 🏗️ 核心架构设计

### 1. 模块化架构
- **AI模块** (`ai_module.py`) - 独立的AI对话管理，支持多种对话类型
- **TTS模块** (`tts_module.py`) - 语音合成和播放管理
- **配置模块** (`config.py`) - 统一的环境配置和参数管理
- **核心系统** (`core_systems.rpy`) - 游戏核心机制和数据结构

### 2. 异步处理机制
- **后台AI生成** - 使用任务盒子(task box)模式实现非阻塞AI调用
- **多线程音频** - TTS合成和播放在独立线程中执行
- **响应式UI** - 保证用户界面始终流畅响应

### 3. 数据流架构
```
用户输入 → 游戏逻辑 → AI处理 → 响应生成 → TTS合成 → 音频播放
    ↓         ↓         ↓         ↓         ↓         ↓
  选择菜单   状态更新   API调用   文本处理   语音生成   同步显示
```

### 4. 错误处理与容错
- **多级配置回退** - 支持config文件、环境变量等多种配置方式
- **API调用重试** - 网络异常时的自动重试机制  
- **优雅降级** - TTS失败时不影响游戏正常进行
- **详细日志** - 完整的调试信息和错误追踪

### 5. 可扩展性设计
- **插件化TTS** - 支持多种TTS服务提供商
- **模块化AI** - 易于接入不同的AI模型和服务
- **主题化UI** - 支持不同的视觉风格和主题切换
- **本地化支持** - 为多语言扩展预留接口

---

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Ren'Py 8.0+
- 稳定的网络连接（用于AI API调用）

### 安装步骤
1. 克隆项目：`git clone <repository-url>`
2. 复制 `.env.example` 为 `.env`
3. 在 `.env` 中配置您的 OpenAI API 密钥
4. 使用 Ren'Py 启动器打开项目
5. 点击"Launch Project"开始游戏

### 测试TTS功能
```bash
cd dlutHosGame
python test_tts_complete.py    # 完整功能测试
python simple_tts_test.py      # 快速测试
```