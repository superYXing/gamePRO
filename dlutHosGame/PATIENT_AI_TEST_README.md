# 患者AI对话测试说明

## 📁 测试文件介绍

### 1. `patient_conversation_test.py` - 完整测试系统
**推荐使用** - 功能最完整的患者AI对话测试工具

**功能特点:**
- ✅ 交互式对话模式 (与患者AI实时对话)
- ✅ 自动场景测试模式 (8个预设医患对话场景)
- ✅ 对话历史管理 (查看、重置)
- ✅ 错误处理和默认回应
- ✅ 完整的患者角色设定

### 2. `test_patient_ai_openai.py` - 原始版本
基于您提供的代码模板，包含连续对话功能

### 3. `simple_patient_test.py` - 简化测试
快速测试患者AI基本功能

### 4. `quick_api_test.py` - API连接测试
验证OpenAI API连接是否正常

## 🚀 使用方法

### 安装依赖
```bash
pip install openai
```

### 运行完整测试 (推荐)
```bash
python patient_conversation_test.py
```

### 运行其他测试
```bash
python simple_patient_test.py
python quick_api_test.py
```

## 🎭 患者角色设定

**患者信息:**
- 姓名: 李秀兰
- 性别: 女
- 年龄: 39岁
- 症状: 头晕，起身偶有眼前发黑、心悸症状
- 病史: 无病史

**患者性格:**
- 性格急躁，对身体不适容忍度低
- 就医时容易因担忧病情产生不满
- 会急切打断医生，强调自己的不适
- 可能质疑医生能力，抱怨就医流程
- 体现真实的医患互动张力

## 🎯 测试场景

### 交互式模式
- 医生输入话语，患者AI自动回应
- 支持多轮连续对话
- 可查看对话历史
- 可随时重置对话

### 自动测试模式
包含8个典型医患对话场景:
1. 初诊问询
2. 症状询问  
3. 检查建议
4. 安抚患者
5. 治疗说明
6. 费用询问
7. 复诊安排
8. 生活建议

## 📊 示例对话

```
医生: 您好，请详细描述一下您的症状。
患者: 医生，我最近老是头晕，特别是起床的时候眼前一黑，心跳得厉害！这都快一个月了，我真的很担心是不是得了什么大病？

医生: 这些症状持续多长时间了？有什么诱因吗？  
患者: 都一个月了！医生您快给我看看，我每天都担心得睡不着觉，会不会是心脏病啊？我家里还有孩子要照顾呢！

医生: 请您不要太担心，我们会帮您找到解决方案。
患者: 医生，您说不要担心，可是我这症状这么明显，您能确定不是什么严重的病吗？我真的很害怕！
```

## 🔧 技术细节

### API配置
- 基础URL: `https://yunwu.ai/v1`
- 模型: `gpt-4o-mini`
- 温度: 0.8 (增加随机性，更自然)
- 最大tokens: 200

### 消息格式优化
- 确保最后一条消息角色为`user`，避免API错误
- 使用明确的指令格式: "医生：{消息}\n请按系统设定，以患者身份用约60字回应。"

### 错误处理
- API调用失败时使用预设默认回应
- 网络超时保护 (30秒)
- 优雅的错误提示

## 🎮 与游戏系统对接

这些测试文件模拟了游戏中的患者AI对话功能:
- 相同的患者角色设定
- 相同的API调用方式  
- 相同的消息格式处理
- 相同的错误处理机制

可以直接用于验证游戏中的患者AI对话效果！
